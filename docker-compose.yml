volumes:
    mysql_data:

services:
    sqldb:
        image: mysql:5.7
        container_name: helper-mysql
        volumes:
            - mysql_data:/var/lib/mysql
        environment:
            - MYSQL_DATABASE=helper
            - MYSQL_USER=helper
            - MYSQL_PASSWORD=helper
            - MYSQL_ROOT_PASSWORD=helper
        command: --default-storage-engine innodb
        restart: unless-stopped
        healthcheck:
            test: mysqladmin -p$$MYSQL_ROOT_PASSWORD ping -h localhost
            interval: 20s
            start_period: 10s
            timeout: 10s
            retries: 3
    helper:
        image: mzkki/helper:latest
        container_name: helper-server
        environment:
            - DB_CONNECTION=mysql
            - DB_HOST=sqldb
            - DB_PORT=3306
            - DB_DATABASE=helper
            - DB_USERNAME=helper
            - DB_PASSWORD=helper
            - MAIL_MAILER=smtp
            - MAIL_HOST=mail.binaanugerahsukses.com
            - MAIL_PORT=465
            - MAIL_USERNAME=siaga@mail.binaanugerahsukses.com
            - MAIL_PASSWORD=katasandiemail123
            - MAIL_ENCRYPTION=null
            - GITHUB_ID=Ov23liVMU32TkNdXjR3c
            - GITHUB_SECRET=4a19247659fd6dfe0e3acbd4093471cb580811e0
            - GITHUB_URL=https://mka.mzkki.my.id/oauth/callback/github
            - APP_URL=https://mka.mzkki.my.id/
            - APP_DEBUG=FALSE
            - APP_NAME="MKA - PM"
            - APP_FORCE_HTTPS=true
            - APP_ENV=production
        depends_on:
            - sqldb
        restart: "no"
        ports:
            - 8000:8000
        volumes:
            - /etc/localtime:/etc/localtime
    helper-queue:
        image: mzkki/helper:latest
        container_name: helper-queue
        depends_on:
            - helper
        restart: always
        command: php artisan queue:work
